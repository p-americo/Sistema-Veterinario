<div class="container">
  <h1 class="title">Gestão de Clientes</h1>

  <!-- Alert Messages -->
  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
    <button class="close-btn" (click)="errorMessage = ''">×</button>
  </div>
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
    <button class="close-btn" (click)="successMessage = ''">×</button>
  </div>

  <!-- Search Section -->
  <div class="card">
    <div class="card-header">
      <h2>Consultar Clientes</h2>
    </div>
    <div class="card-body">
      <form [formGroup]="searchForm" (ngSubmit)="searchClientes()">
        <div class="form-group">
          <label for="searchType">Buscar por:</label>
          <select id="searchType" formControlName="searchType" class="form-control">
            <option value="nome">Nome</option>
            <option value="id">ID</option>
          </select>
        </div>
        <div class="form-group">
          <label for="searchTerm">Termo de busca:</label>
          <input type="text" id="searchTerm" formControlName="searchTerm" class="form-control" placeholder="Digite o termo de busca">
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Buscar</button>
          <button type="button" class="btn btn-secondary" (click)="loadClientes()">Listar Todos</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Client Form Section -->
  <div class="card">
    <div class="card-header">
      <h2>{{ isEditing ? 'Editar Cliente' : 'Cadastrar Novo Cliente' }}</h2>
    </div>
    <div class="card-body">
      <form [formGroup]="clienteForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="nome">Nome:</label>
          <input type="text" id="nome" formControlName="nome" class="form-control" placeholder="Nome completo">
          <div *ngIf="clienteForm.get('nome')?.invalid && clienteForm.get('nome')?.touched" class="error-message">
            Nome é obrigatório e deve ter no máximo 100 caracteres.
          </div>
        </div>

        <div class="form-group">
          <label for="cpf">CPF:</label>
          <input type="text" id="cpf" formControlName="cpf" class="form-control" placeholder="Apenas números (11 dígitos)">
          <div *ngIf="clienteForm.get('cpf')?.invalid && clienteForm.get('cpf')?.touched" class="error-message">
            CPF é obrigatório e deve conter exatamente 11 dígitos numéricos.
          </div>
        </div>

        <div class="form-group">
          <label for="dataNascimento">Data de Nascimento:</label>
          <input type="date" id="dataNascimento" formControlName="dataNascimento" class="form-control">
          <div *ngIf="clienteForm.get('dataNascimento')?.invalid && clienteForm.get('dataNascimento')?.touched" class="error-message">
            Data de nascimento é obrigatória.
          </div>
        </div>

        <div class="form-group">
          <label for="telefone">Telefone:</label>
          <input type="text" id="telefone" formControlName="telefone" class="form-control" placeholder="Telefone com DDD">
          <div *ngIf="clienteForm.get('telefone')?.invalid && clienteForm.get('telefone')?.touched" class="error-message">
            Telefone é obrigatório e deve ter no máximo 20 caracteres.
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" id="email" formControlName="email" class="form-control" placeholder="exemplo@email.com">
          <div *ngIf="clienteForm.get('email')?.invalid && clienteForm.get('email')?.touched" class="error-message">
            Email é obrigatório e deve ser um endereço válido.
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="clienteForm.invalid">
            {{ isEditing ? 'Atualizar' : 'Cadastrar' }}
          </button>
          <button type="button" class="btn btn-secondary" (click)="resetForm()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Client List Section -->
  <div class="card">
    <div class="card-header">
      <h2>Lista de Clientes</h2>
    </div>
    <div class="card-body">
      <div *ngIf="clientes.length === 0" class="no-data">
        Nenhum cliente encontrado.
      </div>
      <table *ngIf="clientes.length > 0" class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>CPF</th>
            <th>Data de Nascimento</th>
            <th>Telefone</th>
            <th>Email</th>
            <th>Data de Cadastro</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cliente of clientes">
            <td>{{ cliente.id }}</td>
            <td>{{ cliente.nome }}</td>
            <td>{{ cliente.cpf }}</td>
            <td>{{ cliente.dataNascimento | date:'dd/MM/yyyy' }}</td>
            <td>{{ cliente.telefone }}</td>
            <td>{{ cliente.email }}</td>
            <td>{{ cliente.dataCadastro | date:'dd/MM/yyyy' }}</td>
            <td class="actions">
              <button class="btn btn-sm btn-info" (click)="editCliente(cliente)">Editar</button>
              <button class="btn btn-sm btn-danger" (click)="deleteCliente(cliente.id)">Excluir</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
